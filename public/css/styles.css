body { margin: 0; overflow: hidden; background-color: #050510; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
canvas { display: block; width: 100vw; height: 100vh; }

/* Contenedor del canvas 3D */
#three-root { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 0; }
#webgl-fallback { display: none; position: fixed; inset: 0; z-index: 3; background: #050510; color: #fff; display:flex; align-items:center; justify-content:center; padding:20px; }
#ui-layer { z-index: 2; pointer-events: none; }

/* Header / Navigation */
.site-header { position: fixed; top: 12px; left: 12px; z-index: 999; background: rgba(0,0,0,0.6); border-radius: 10px; padding: 6px; border: 1px solid rgba(255,255,255,0.04); }
.site-header .container { display:flex; align-items:center; justify-content:flex-start; gap:12px; margin:0; padding:6px 10px; min-width: 280px; max-width: 90vw; flex-wrap:nowrap; }
.brand { flex: 0 0 auto; }
.header-actions { flex: 0 0 auto; margin-left: auto; }
nav { flex: 0 0 auto; }
.brand a { color:#ffeb3b; font-weight:700; text-decoration:none; }
.nav-list { list-style:none; display:flex; gap:8px; margin:0; padding:0; flex-wrap:nowrap; align-items:center; }
.nav-list a { color:#fff; text-decoration:none; padding:6px 8px; border-radius:6px; white-space:nowrap; font-size:14px; }
.nav-list a:focus, .nav-list a:hover { outline:none; background: rgba(255,255,255,0.04); box-shadow: 0 0 0 3px rgba(255,255,255,0.03); }

/* Ensure main content is not hidden behind header on small screens */
main { padding-top: 64px; }

@media (max-width: 480px) {
  .site-header .container { gap:6px; padding:6px; }
  .nav-list a { font-size:12px; padding:6px 6px; }
}

/* Skip link for accessibility */
.skip-link { position:absolute; left: -999px; top: auto; width:1px; height:1px; overflow:hidden; }
.skip-link:focus { left: 8px; top: 8px; width:auto; height:auto; padding:8px 12px; background:#fff; color:#050510; z-index:1000; border-radius:6px; }

/* Page content */
.page-content { max-width:1100px; margin: 24px auto; padding: 16px; color: #fff; z-index:2; position:relative; }

/* Focus styles: avoid removing outlines globally, provide clear visible focus rings */
:focus {
  outline: 3px solid rgba(255,255,255,0.08);
  outline-offset: 2px;
}

:focus:not(:focus-visible) { outline: none; }

.btn:focus, .nav-list a:focus, .btn:focus-visible, .nav-list a:focus-visible {
  box-shadow: 0 0 0 4px rgba(0,200,255,0.18);
  transform: none;
  border-radius: 6px;
}

/* Ensure skip link remains prominent on focus */
.skip-link:focus { left: 8px; top: 8px; width:auto; height:auto; padding:8px 12px; background:#fff; color:#050510; z-index:1000; border-radius:6px; }

/* Responsive tweaks */
@media (max-width: 768px) {
  .nav-list { display:none; }
  .page-content { padding: 12px; }
}

/* Toggle icon button */
.header-actions { display:flex; align-items:center; margin-left: 12px; }
.icon-btn {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.06);
  color: #fff;
  padding: 6px 8px;
  border-radius: 6px;
  cursor: pointer;
  margin-left: 12px;
  display: inline-flex;
  align-items: center;
  gap:8px;
}
.icon-btn.active, .icon-btn[aria-pressed="true"] { box-shadow: 0 0 8px rgba(0,200,255,0.2); background: rgba(255,255,255,0.02); }
.start-btn { font-weight: 600; font-size: 13px; padding: 6px 10px; }
.start-btn.loading { opacity: 0.7; transform: translateY(1px); pointer-events: none; }

/* Mobile controls visibility and animation */
#mobile-controls {
  pointer-events: none;
  display: none; /* hidden by default */
  width: 100%;
  padding-bottom: 20px;
  justify-content: space-between;
  align-items: flex-end;
  padding: 20px;
  box-sizing: border-box;
  opacity: 0; /* hidden */
  transform: translateY(8px);
  transition: opacity 260ms ease, transform 260ms ease;
}

/* Loading overlay shown during demo startup */
.loading-overlay { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(5,5,16,0.9), rgba(5,5,16,0.95)); z-index: 1100; opacity: 0; pointer-events: none; transition: opacity 300ms ease; }
.loading-overlay[aria-hidden="false"] { opacity: 1; pointer-events: auto; }
.loading-content { text-align:center; color: #fff; display:flex; flex-direction:column; align-items:center; gap:12px; }
.loading-visual { width: 220px; height: 120px; display:flex; align-items:center; justify-content:center; overflow:visible; }
/* only animate when overlay is shown */
.loading-overlay[aria-hidden="false"] .loading-car { transform: translateY(-120%); animation: carFlyIn 900ms cubic-bezier(.2,.8,.2,1) forwards; filter: drop-shadow(0 12px 24px rgba(0,0,0,0.6)); }

@keyframes carFlyIn { 0% { transform: translateY(-120%) scale(0.6) rotate(-18deg); opacity:0 } 60% { transform: translateY(8%) scale(1.05) rotate(6deg); opacity:1 } 100% { transform: translateY(0%) scale(1) rotate(0deg) } }

.loading-text { font-size:18px; color:#eaf6ff; }
.loading-actions { display:flex; gap:8px; }
.loading-actions .icon-btn { background: rgba(255,255,255,0.04); }

/* small screens: keep overlay content compact */
@media (max-width: 480px) {
  .loading-visual { width: 160px; height: 80px; }
  .loading-text { font-size:16px; }
} 
/* Small screens: show controls */
@media (max-width: 768px) {
  #mobile-controls { display:flex; pointer-events: auto; opacity:1; transform: translateY(0); }
}

/* Desktop: hidden by default; show when user enables with the body class OR when .visible is set */
@media (min-width: 769px) {
  #mobile-controls { display:none; }
  body.show-controls-on-desktop #mobile-controls, #mobile-controls.visible { display:flex; pointer-events: auto; opacity:1; transform: translateY(0); }
}

/* Route panel (left side) */
.route-panel { position: fixed; left: 18px; top: 100px; width: 200px; background: rgba(6,6,10,0.6); padding: 10px; border-radius: 10px; color: #eaf6ff; z-index: 1200; display: none; }
@media (min-width: 880px) { .route-panel { display:block; } }
.route-panel .route-controls { display:flex; gap:8px; margin-bottom: 8px; align-items:center; }
.route-panel .route-controls .btn { pointer-events: auto; font-size: 13px; padding: 6px 8px; min-width: 36px; height: 34px; line-height: 1; border-radius: 8px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.06); color: #eaf6ff; display: inline-flex; align-items: center; justify-content: center; gap:8px; transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease; }
.route-panel .route-controls .btn svg { width: 16px; height: 16px; display:block; }
.route-panel .route-controls .btn .btn-label { display:inline-block; }
.route-panel .route-controls .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,150,255,0.06); background: linear-gradient(180deg, rgba(0,120,255,0.06), rgba(255,255,255,0.02)); }
.route-panel .route-controls .btn:active { transform: translateY(0); }
.route-panel .route-controls .btn:focus { outline: none; box-shadow: 0 0 0 6px rgba(0,200,255,0.10); }
#start-tour { font-weight: 600; padding: 6px 10px; height: 36px; }
#cancel-tour { background: transparent; border: 1px solid rgba(255,255,255,0.06); padding: 4px 8px; height: 32px; color: #ffd; }
#next-stop { background: #00aaff; color: #042; padding: 4px 8px; height: 32px; border-radius: 6px; }

/* Mobile: compact left-side rail with icon-only timeline */
@media (max-width: 879px) {
  .route-panel { left: 8px; top: 86px; bottom: auto; width: 64px; padding: 8px; border-radius: 12px; display:flex; flex-direction:column; align-items:center; max-height: calc(100vh - 120px); overflow-y: auto; }
  .route-panel .timeline { display:flex; flex-direction:column; gap: 14px; padding-left: 0; }
  .route-panel .timeline::before { left: 32px; top: 8px; bottom: 8px; }
  .route-panel .timeline .timeline-item .label { display:none; }
  .route-panel .route-btn { padding-left: 8px; padding-right: 8px; width: 48px; height: 48px; border-radius: 12px; justify-content:center; align-items:center; padding:0; }
  .route-panel .route-btn .pin { left: 12px; transform: none; position: static; margin:0; }
  .route-panel .route-controls { margin-top: 8px; display:flex; flex-direction:column; gap:8px; }
  .route-panel .route-controls .btn { width: 40px; height: 40px; padding: 0; min-width: 40px; border-radius: 8px; }
  .route-panel .route-controls .btn .btn-label { display: none; }
  .route-panel .route-settings { margin-top: 8px; display:flex; flex-direction:column; gap:6px; align-items:center; }
  .reduced-note { font-size: 11px; color: #ffd; max-width: 120px; text-align:center; display:block; }
  .force-label { display:flex; align-items:center; gap:6px; font-size:12px; }
}

/* Route settings (desktop + mobile compact rules) */
.route-settings { margin-top: 8px; font-size:12px; opacity:0.95; }
.force-label { display:flex; align-items:center; gap:8px; }
.reduced-note { margin-top:6px; color:#ffd; font-size:11px; display:none; }

/* Extra small phones: ensure touch targets */
@media (max-width: 480px) {
  .route-panel .route-controls .btn { width: 44px; height: 44px; }
  .route-panel { bottom: 10px; padding: 6px; }
}
.route-panel #route-list, .route-panel .timeline { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:12px; }
.route-panel .timeline { position: relative; padding-left: 28px; }
.route-panel .timeline::before { content: ''; position: absolute; left: 18px; top: 8px; bottom: 8px; width: 2px; background: linear-gradient(180deg, rgba(0,120,255,0.12), rgba(0,200,255,0.06)); border-radius: 2px; }
.route-panel .route-btn { background: rgba(255,255,255,0.02); border: none; color: inherit; padding: 8px 10px; border-radius:6px; text-align:left; cursor: pointer; position: relative; padding-left: 44px; display:flex; align-items:center; gap:8px; transition: background 180ms ease, transform 160ms ease; }
.route-panel .route-btn .pin { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; filter: drop-shadow(0 6px 10px rgba(0,120,255,0.06)); transition: transform 220ms cubic-bezier(.2,.8,.2,1), box-shadow 220ms ease; }
.route-panel .route-btn .pin svg { width: 18px; height: 18px; display: block; }
.route-panel .route-btn:hover .pin, .route-panel .route-btn:focus .pin { transform: translateY(-4px) scale(1.06); box-shadow: 0 8px 22px rgba(0,120,255,0.10); }
.route-panel .route-btn.active { background: linear-gradient(120deg, rgba(0,120,255,0.08), rgba(0,215,255,0.06)); box-shadow: 0 6px 20px rgba(0,170,255,0.08); }
.route-panel .route-btn.active .pin { transform: translateY(-2px) scale(1.04); box-shadow: 0 10px 28px rgba(0,170,255,0.12); }
.route-panel .route-btn:focus { box-shadow: 0 0 0 6px rgba(0,170,255,0.06); }
.route-panel .route-btn .pin svg path { transition: fill 220ms ease; }
.route-panel .route-btn .pin svg defs linearGradient stop { transition: stop-color 220ms ease; }
.route-panel .btn { background: rgba(255,255,255,0.04); border: none; color: inherit; padding:6px 8px; border-radius:6px; cursor:pointer; }

/* Screen-reader only */
.sr-only { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; border: 0; padding: 0; margin: -1px; }

/* Visual feedback for active/tapped control */
.btn.active { box-shadow: 0 0 0 6px rgba(0,200,255,0.12); transform: scale(1.02); }




/* Interfaz de Usuario (UI) */
#ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

#info-panel {
    padding: 20px;
    color: white;
    text-shadow: 1px 1px 2px black;
    text-align: center;
    transition: opacity 0.5s;
}

h1 { margin: 0; font-size: 24px; color: #ffeb3b; text-transform: uppercase; letter-spacing: 2px; }
p { margin: 5px 0; font-size: 14px; opacity: 0.8; }

#speedometer {
    font-size: 32px;
    font-weight: bold;
    color: #fff;
    margin-top: 10px;
}

/* --- Pop-up Neón (Compacto) --- */
#neon-popup {
    position: absolute;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    width: auto;
    min-width: 250px;
    max-width: 400px;
    padding: 15px;
    text-align: center;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #0ff;
    border-radius: 10px;
    color: #fff;
    opacity: 0;
    transition: opacity 0.3s ease-in-out, transform 0.3s;
    box-shadow: 0 0 10px #0ff, inset 0 0 5px #0ff;
    pointer-events: none;
    backdrop-filter: blur(3px);
}

#neon-popup.active {
    opacity: 1;
    transform: translateX(-50%) scale(1);
}

#neon-title {
    font-size: 22px;
    font-weight: bold;
    color: #0ff;
    text-transform: uppercase;
    text-shadow: 0 0 5px #0ff;
    margin: 0 0 5px 0;
}

#neon-desc {
    font-size: 14px;
    color: #eee;
    text-shadow: none;
    margin: 0;
}

/* Controles Táctiles para Móvil */
#mobile-controls {
    pointer-events: auto;
    display: none;
    width: 100%;
    padding-bottom: 20px;
    justify-content: space-between;
    align-items: flex-end;
    padding: 20px;
    box-sizing: border-box;
}

.control-group {
    display: flex;
    gap: 10px;
}

.btn {
    width: 70px;
    height: 70px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    color: white;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    backdrop-filter: blur(4px);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}

.btn:active { background: rgba(255, 255, 255, 0.5); transform: scale(0.95); }
.btn-gas { background: rgba(0, 255, 0, 0.2); border-color: #0f0; }
.btn-brake { background: rgba(255, 0, 0, 0.2); border-color: #f00; }

@media (max-width: 768px) {
    #mobile-controls { display: flex; }
    #instructions { display: none; }
    #neon-popup { top: 15%; width: 85%; max-width: none; }
    #neon-title { font-size: 18px; }
    #neon-desc { font-size: 13px; }
}
